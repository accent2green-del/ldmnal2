<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì íŒ¨ë„ ì˜¤ë¥˜ ë””ë²„ê¹…</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #dc3545;
            text-align: center;
        }
        .step {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .step h3 {
            color: #007bff;
            margin-top: 0;
        }
        .debug-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        .debug-button:hover {
            background: #0056b3;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .code {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
        #console-output {
            background: #1a1a1a;
            color: #00ff00;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>ğŸ” ê´€ë¦¬ì íŒ¨ë„ ì˜¤ë¥˜ ë””ë²„ê¹…</h1>
        
        <div class="info">
            <strong>ëª©ì :</strong> "ì˜ˆê¸°ì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤" ì˜¤ë¥˜ì˜ ì›ì¸ì„ ì°¾ê³  í•´ê²°í•˜ê¸° ìœ„í•œ ë‹¨ê³„ë³„ ì§„ë‹¨
        </div>
        
        <div class="step">
            <h3>1ë‹¨ê³„: ê¸°ë³¸ ì˜ì¡´ì„± í™•ì¸</h3>
            <button class="debug-button" onclick="checkDependencies()">ì˜ì¡´ì„± í™•ì¸</button>
            <div id="dependencies-result"></div>
        </div>
        
        <div class="step">
            <h3>2ë‹¨ê³„: DataManager ìƒíƒœ í™•ì¸</h3>
            <button class="debug-button" onclick="checkDataManager()">DataManager í™•ì¸</button>
            <div id="datamanager-result"></div>
        </div>
        
        <div class="step">
            <h3>3ë‹¨ê³„: AdminManager ìƒíƒœ í™•ì¸</h3>
            <button class="debug-button" onclick="checkAdminManager()">AdminManager í™•ì¸</button>
            <div id="adminmanager-result"></div>
        </div>
        
        <div class="step">
            <h3>4ë‹¨ê³„: ê´€ë¦¬ì ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h3>
            <button class="debug-button" onclick="testAdminLogin()">ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
            <div id="login-result"></div>
        </div>
        
        <div class="step">
            <h3>5ë‹¨ê³„: ì•ˆì „í•œ ê´€ë¦¬ì íŒ¨ë„ í‘œì‹œ</h3>
            <button class="debug-button" onclick="safeShowAdminPanel()">ì•ˆì „í•œ íŒ¨ë„ í‘œì‹œ</button>
            <div id="panel-result"></div>
        </div>
        
        <div class="step">
            <h3>6ë‹¨ê³„: ì‹¤ì‹œê°„ ì½˜ì†” ë¡œê·¸</h3>
            <button class="debug-button" onclick="toggleConsoleCapture()">ì½˜ì†” ìº¡ì²˜ í† ê¸€</button>
            <div id="console-output"></div>
        </div>
        
        <div class="step">
            <h3>7ë‹¨ê³„: ë©”ì¸ ì‚¬ì´íŠ¸ ì ‘ì†</h3>
            <button class="debug-button" onclick="goToMainSite()">ë©”ì¸ ì‚¬ì´íŠ¸ë¡œ ì´ë™</button>
        </div>
    </div>

    <!-- ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ë“¤ ë¡œë“œ -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/logger.js"></script>
    <script src="js/eventEmitter.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/admin.js"></script>

    <script>
        let consoleCapture = false;
        let originalConsole = {};

        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}">${message}</div>`;
        }

        function addToConsole(message, type = 'log') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const color = {
                'log': '#00ff00',
                'error': '#ff0000',
                'warn': '#ffff00',
                'info': '#00ffff'
            }[type] || '#00ff00';
            
            output.innerHTML += `<div style="color: ${color}">[${timestamp}] ${type.toUpperCase()}: ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function toggleConsoleCapture() {
            if (!consoleCapture) {
                // ì½˜ì†” ìº¡ì²˜ ì‹œì‘
                originalConsole.log = console.log;
                originalConsole.error = console.error;
                originalConsole.warn = console.warn;
                originalConsole.info = console.info;

                console.log = (...args) => {
                    originalConsole.log(...args);
                    addToConsole(args.join(' '), 'log');
                };
                console.error = (...args) => {
                    originalConsole.error(...args);
                    addToConsole(args.join(' '), 'error');
                };
                console.warn = (...args) => {
                    originalConsole.warn(...args);
                    addToConsole(args.join(' '), 'warn');
                };
                console.info = (...args) => {
                    originalConsole.info(...args);
                    addToConsole(args.join(' '), 'info');
                };

                consoleCapture = true;
                addToConsole('ì½˜ì†” ìº¡ì²˜ ì‹œì‘ë¨', 'info');
                
            } else {
                // ì½˜ì†” ìº¡ì²˜ ì¤‘ì§€
                console.log = originalConsole.log;
                console.error = originalConsole.error;
                console.warn = originalConsole.warn;
                console.info = originalConsole.info;
                
                consoleCapture = false;
                addToConsole('ì½˜ì†” ìº¡ì²˜ ì¤‘ì§€ë¨', 'info');
            }
        }

        function checkDependencies() {
            let results = [];
            let allGood = true;

            // ê¸°ë³¸ ì „ì—­ ê°ì²´ë“¤ í™•ì¸
            const dependencies = [
                { name: 'AppConfig', obj: window.AppConfig },
                { name: 'Utils', obj: window.Utils },
                { name: 'Logger', obj: window.Logger },
                { name: 'EventEmitter', obj: window.EventEmitter },
                { name: 'dataManager', obj: window.dataManager },
                { name: 'adminManager', obj: window.adminManager }
            ];

            dependencies.forEach(dep => {
                if (dep.obj) {
                    results.push(`âœ… ${dep.name}: ë¡œë“œë¨`);
                } else {
                    results.push(`âŒ ${dep.name}: ë¡œë“œë˜ì§€ ì•ŠìŒ`);
                    allGood = false;
                }
            });

            // DOM ìš”ì†Œë“¤ í™•ì¸
            const domElements = [
                { name: 'content-body', id: 'content-body' },
                { name: 'admin-modal', id: 'admin-modal' },
                { name: 'admin-btn', id: 'admin-btn' }
            ];

            domElements.forEach(elem => {
                const element = document.getElementById(elem.id);
                if (element) {
                    results.push(`âœ… DOM ${elem.name}: ì¡´ì¬í•¨`);
                } else {
                    results.push(`âš ï¸ DOM ${elem.name}: ì¡´ì¬í•˜ì§€ ì•ŠìŒ (ë©”ì¸ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©)`);
                }
            });

            const resultType = allGood ? 'success' : 'warning';
            showResult('dependencies-result', results.join('<br>'), resultType);
        }

        function checkDataManager() {
            let results = [];
            let status = 'info';

            if (!window.dataManager) {
                showResult('datamanager-result', 'âŒ DataManagerê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!', 'error');
                return;
            }

            const dm = window.dataManager;

            // DataManager ë©”ì„œë“œë“¤ í™•ì¸
            const methods = [
                'initialize', 'getDataSummary', 'getDepartments', 
                'getCategories', 'getCategoriesByDepartment', 
                'getProcessesByCategory', 'addDepartment', 'addCategory', 'addProcess'
            ];

            methods.forEach(method => {
                if (typeof dm[method] === 'function') {
                    results.push(`âœ… ${method}: ë©”ì„œë“œ ì¡´ì¬`);
                } else {
                    results.push(`âŒ ${method}: ë©”ì„œë“œ ì—†ìŒ`);
                    status = 'error';
                }
            });

            // ë°ì´í„° ìƒíƒœ í™•ì¸
            try {
                const summary = dm.getDataSummary();
                results.push(`ğŸ“Š ë°ì´í„° í˜„í™©: ë¶€ì„œ ${summary.departments}ê°œ, ì¹´í…Œê³ ë¦¬ ${summary.categories}ê°œ, í”„ë¡œì„¸ìŠ¤ ${summary.processes}ê°œ`);
                
                if (dm.initialized) {
                    results.push(`âœ… ì´ˆê¸°í™” ìƒíƒœ: ì™„ë£Œ`);
                } else {
                    results.push(`âš ï¸ ì´ˆê¸°í™” ìƒíƒœ: ë¯¸ì™„ë£Œ`);
                    status = 'warning';
                }
                
            } catch (error) {
                results.push(`âŒ ë°ì´í„° ì ‘ê·¼ ì˜¤ë¥˜: ${error.message}`);
                status = 'error';
            }

            showResult('datamanager-result', results.join('<br>'), status);
        }

        function checkAdminManager() {
            let results = [];
            let status = 'info';

            if (!window.adminManager) {
                showResult('adminmanager-result', 'âŒ AdminManagerê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!', 'error');
                return;
            }

            const am = window.adminManager;

            // AdminManager ë©”ì„œë“œë“¤ í™•ì¸
            const methods = [
                'showLoginModal', 'handleLogin', 'showAdminPanel', 
                'safeDataManager', 'safeDepartments', 'safeDataSummary',
                'bindAdminPanelEvents', 'renderTabContent'
            ];

            methods.forEach(method => {
                if (typeof am[method] === 'function') {
                    results.push(`âœ… ${method}: ë©”ì„œë“œ ì¡´ì¬`);
                } else {
                    results.push(`âŒ ${method}: ë©”ì„œë“œ ì—†ìŒ`);
                    status = 'warning';
                }
            });

            // AdminManager ìƒíƒœ í™•ì¸
            results.push(`ğŸ”’ ë¡œê·¸ì¸ ìƒíƒœ: ${am.isLoggedIn ? 'ë¡œê·¸ì¸ë¨' : 'ë¡œê·¸ì•„ì›ƒë¨'}`);
            results.push(`ğŸ—‚ï¸ í˜„ì¬ íƒ­: ${am.currentTab || 'ì—†ìŒ'}`);
            results.push(`ğŸ« ì„¸ì…˜ í† í°: ${am.sessionToken ? 'ìˆìŒ' : 'ì—†ìŒ'}`);

            // ì•ˆì „í•œ ë©”ì„œë“œ í…ŒìŠ¤íŠ¸
            try {
                const safeStats = am.safeDataSummary();
                results.push(`âœ… ì•ˆì „í•œ í†µê³„ ì¡°íšŒ: ì„±ê³µ (ë¶€ì„œ ${safeStats.departments}ê°œ)`);
            } catch (error) {
                results.push(`âŒ ì•ˆì „í•œ í†µê³„ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`);
                status = 'error';
            }

            showResult('adminmanager-result', results.join('<br>'), status);
        }

        function testAdminLogin() {
            if (!window.adminManager) {
                showResult('login-result', 'âŒ AdminManagerê°€ ì—†ìŠµë‹ˆë‹¤!', 'error');
                return;
            }

            try {
                const am = window.adminManager;
                
                // ë¡œê·¸ì¸ ìƒíƒœ ì„¤ì •
                am.isLoggedIn = true;
                am.sessionToken = 'debug-session-' + Date.now();
                
                showResult('login-result', `âœ… ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì„±ê³µ!<br>ì„¸ì…˜ í† í°: ${am.sessionToken}<br>ë¡œê·¸ì¸ ìƒíƒœ: ${am.isLoggedIn}`, 'success');
                
            } catch (error) {
                showResult('login-result', `âŒ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        function safeShowAdminPanel() {
            if (!window.adminManager) {
                showResult('panel-result', 'âŒ AdminManagerê°€ ì—†ìŠµë‹ˆë‹¤!', 'error');
                return;
            }

            try {
                const am = window.adminManager;
                
                // ë¡œê·¸ì¸ í™•ì¸
                if (!am.isLoggedIn) {
                    am.isLoggedIn = true;
                    am.sessionToken = 'debug-session-' + Date.now();
                }

                // ê°€ìƒì˜ content-body ìƒì„±
                let contentBody = document.getElementById('content-body');
                if (!contentBody) {
                    contentBody = document.createElement('div');
                    contentBody.id = 'content-body';
                    contentBody.style.cssText = 'margin-top: 20px; padding: 20px; border: 2px dashed #007bff; border-radius: 8px;';
                    document.body.appendChild(contentBody);
                }

                // ì•ˆì „í•œ ê´€ë¦¬ì íŒ¨ë„ í‘œì‹œ
                console.log('ğŸ”§ ì•ˆì „í•œ ê´€ë¦¬ì íŒ¨ë„ í‘œì‹œ ì‹œì‘');
                am.showAdminPanel();
                
                setTimeout(() => {
                    const panel = document.querySelector('.admin-panel');
                    if (panel) {
                        showResult('panel-result', 'âœ… ê´€ë¦¬ì íŒ¨ë„ì´ ì„±ê³µì ìœ¼ë¡œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤!<br>í˜ì´ì§€ ì•„ë˜ìª½ì—ì„œ í™•ì¸í•˜ì„¸ìš”.', 'success');
                    } else {
                        showResult('panel-result', 'âŒ ê´€ë¦¬ì íŒ¨ë„ì´ ë Œë”ë§ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                    }
                }, 500);
                
            } catch (error) {
                console.error('ê´€ë¦¬ì íŒ¨ë„ í‘œì‹œ ì˜¤ë¥˜:', error);
                showResult('panel-result', `âŒ ê´€ë¦¬ì íŒ¨ë„ í‘œì‹œ ì‹¤íŒ¨: ${error.message}<br><br>ìƒì„¸ ì˜¤ë¥˜:<br><pre>${error.stack}</pre>`, 'error');
            }
        }

        function goToMainSite() {
            if (confirm('ë©”ì¸ ì‚¬ì´íŠ¸ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.location.href = '/';
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì§„ë‹¨
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('ğŸ” ìë™ ì§„ë‹¨ ì‹œì‘');
                toggleConsoleCapture(); // ì½˜ì†” ìº¡ì²˜ ì‹œì‘
                checkDependencies();
            }, 1000);
        });

        // ì˜¤ë¥˜ ìºì¹˜
        window.addEventListener('error', (event) => {
            addToConsole(`ì „ì—­ ì˜¤ë¥˜: ${event.error.message} (${event.filename}:${event.lineno})`, 'error');
        });
    </script>
</body>
</html>