<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œë³„ í•­ëª© ê´€ë¦¬ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        .test-container {
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .test-title {
            background: #007bff;
            color: white;
            padding: 10px 15px;
            margin: -20px -20px 20px -20px;
            border-radius: 6px 6px 0 0;
            font-size: 18px;
            font-weight: bold;
        }
        
        .test-description {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 6px;
        }
        
        .demo-data {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .demo-column {
            flex: 1;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .demo-column h4 {
            margin-top: 0;
            color: #333;
        }
        
        .btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #218838;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª ê°œë³„ í•­ëª© ê´€ë¦¬ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
        <p>í”„ë¡œì„¸ìŠ¤ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ê³¼ ìƒì„¸ì •ë³´ì°½ì—ì„œ ì‚°ì¶œë¬¼ê³¼ ì°¸ê³ ìë£Œì˜ ê°œë³„ í•­ëª© ê´€ë¦¬ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
        
        <!-- í…ŒìŠ¤íŠ¸ 1: ì‚°ì¶œë¬¼ ê°œë³„ í•­ëª© ê´€ë¦¬ UI -->
        <div class="test-section">
            <div class="test-title">ğŸ”¬ í…ŒìŠ¤íŠ¸ 1: ì‚°ì¶œë¬¼ ê°œë³„ í•­ëª© ê´€ë¦¬ UI</div>
            <div class="test-description">
                ì‚°ì¶œë¬¼ì„ ê°œë³„ í•­ëª©ìœ¼ë¡œ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ, ìˆœì„œ ë³€ê²½í•  ìˆ˜ ìˆëŠ” UIë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
            </div>
            
            <div id="outputs-test-container"></div>
            
            <div class="test-results">
                <h4>í˜„ì¬ ì‚°ì¶œë¬¼ ëª©ë¡:</h4>
                <pre id="outputs-result">[]</pre>
                
                <button class="btn" onclick="testOutputsOperations()">í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€</button>
                <button class="btn btn-secondary" onclick="clearOutputs()">ëª¨ë“  í•­ëª© ì œê±°</button>
            </div>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ 2: ì°¸ê³ ìë£Œ ê°œë³„ í•­ëª© ê´€ë¦¬ UI -->
        <div class="test-section">
            <div class="test-title">ğŸ”¬ í…ŒìŠ¤íŠ¸ 2: ì°¸ê³ ìë£Œ ê°œë³„ í•­ëª© ê´€ë¦¬ UI</div>
            <div class="test-description">
                ì°¸ê³ ìë£Œë¥¼ ê°œë³„ í•­ëª©ìœ¼ë¡œ ê´€ë¦¬í•˜ë©°, ì²¨ë¶€íŒŒì¼ ê¸°ëŠ¥ë„ í¬í•¨ëœ UIë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
            </div>
            
            <div id="references-test-container"></div>
            
            <div class="test-results">
                <h4>í˜„ì¬ ì°¸ê³ ìë£Œ ëª©ë¡:</h4>
                <pre id="references-result">[]</pre>
                
                <button class="btn" onclick="testReferencesOperations()">í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€</button>
                <button class="btn btn-secondary" onclick="clearReferences()">ëª¨ë“  í•­ëª© ì œê±°</button>
            </div>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ 3: ìƒì„¸ì •ë³´ì°½ í‘œì‹œ -->
        <div class="test-section">
            <div class="test-title">ğŸ”¬ í…ŒìŠ¤íŠ¸ 3: ìƒì„¸ì •ë³´ì°½ ê°œë³„ í•­ëª© í‘œì‹œ</div>
            <div class="test-description">
                ìƒì„¸ì •ë³´ì°½ì—ì„œ ê°œë³„ í•­ëª©ë“¤ì´ ì–´ë–»ê²Œ í‘œì‹œë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
            </div>
            
            <div class="demo-data">
                <div class="demo-column">
                    <h4>ğŸ“„ ì‚°ì¶œë¬¼ í‘œì‹œ ì˜ˆì‹œ</h4>
                    <div id="outputs-display-demo"></div>
                </div>
                <div class="demo-column">
                    <h4>ğŸ“š ì°¸ê³ ìë£Œ í‘œì‹œ ì˜ˆì‹œ</h4>
                    <div id="references-display-demo"></div>
                </div>
            </div>
            
            <button class="btn" onclick="updateDisplayDemo()">í‘œì‹œ ì˜ˆì‹œ ì—…ë°ì´íŠ¸</button>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ 4: ë°ì´í„° í˜¸í™˜ì„± -->
        <div class="test-section">
            <div class="test-title">ğŸ”¬ í…ŒìŠ¤íŠ¸ 4: ê¸°ì¡´ ë°ì´í„° í˜¸í™˜ì„±</div>
            <div class="test-description">
                ê¸°ì¡´ í…ìŠ¤íŠ¸ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ê°œë³„ í•­ëª©ìœ¼ë¡œ ë³€í™˜í•˜ê³ , ë‹¤ì‹œ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” í˜¸í™˜ì„±ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
            </div>
            
            <div class="test-results">
                <h4>í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼:</h4>
                <div id="compatibility-results"></div>
                
                <button class="btn" onclick="testCompatibility()">í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let outputsManager, referencesManager;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“ ê°œë³„ í•­ëª© ê´€ë¦¬ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ');
            initializeTests();
        });
        
        // í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
        function initializeTests() {
            // ì‚°ì¶œë¬¼ ê´€ë¦¬ UI ìƒì„±
            const outputsContainer = document.getElementById('outputs-test-container');
            outputsManager = Utils.createItemListManager(
                ['ë¯¼ì›ì‹ ì²­ì„œ(ìš°í¸, íŒ©ìŠ¤, êµ­ë¯¼ì‹ ë¬¸ê³  ë“±)', 'ë¯¼ì›ì²˜ë¦¬ë¶€', 'ë¯¼ì› ì ‘ìˆ˜ì¦'],
                'outputs-manager',
                'outputs',
                updateOutputsResult
            );
            outputsContainer.appendChild(outputsManager.container);
            
            // ì°¸ê³ ìë£Œ ê´€ë¦¬ UI ìƒì„±
            const referencesContainer = document.getElementById('references-test-container');
            referencesManager = Utils.createItemListManager(
                ['2022ë…„ ê³µì§ì ë¯¼ì›ì‘ëŒ€ ë§¤ë‰´ì–¼ - ë¯¼ì›ì‘ëŒ€ ê´€ë ¨ ê¸°ë³¸ì›ì¹™: p.6-7', 'ë¯¼ì› ì²˜ë¦¬ì— ê´€í•œ ë²•ë¥ (ì‹œí–‰ 2022. 07. 12.) - ë¯¼ì› ì²˜ë¦¬ ë‹´ë‹¹ìì˜ ì˜ë¬´ì™€ ë³´í˜¸: ì œ4ì¡°, p.2'],
                'references-manager',
                'references',
                updateReferencesResult
            );
            referencesContainer.appendChild(referencesManager.container);
            
            // ì´ˆê¸° ê²°ê³¼ ì—…ë°ì´íŠ¸
            updateOutputsResult(outputsManager.getItems());
            updateReferencesResult(referencesManager.getItems());
            updateDisplayDemo();
        }
        
        // ì‚°ì¶œë¬¼ ê²°ê³¼ ì—…ë°ì´íŠ¸
        function updateOutputsResult(items) {
            document.getElementById('outputs-result').textContent = JSON.stringify(items, null, 2);
        }
        
        // ì°¸ê³ ìë£Œ ê²°ê³¼ ì—…ë°ì´íŠ¸
        function updateReferencesResult(items) {
            document.getElementById('references-result').textContent = JSON.stringify(items, null, 2);
        }
        
        // ì‚°ì¶œë¬¼ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
        function testOutputsOperations() {
            const testItems = [
                'ì‹ ê·œ ì‚°ì¶œë¬¼ 1: í…ŒìŠ¤íŠ¸ ë¬¸ì„œ',
                'ì‹ ê·œ ì‚°ì¶œë¬¼ 2: ê²€í†  ê²°ê³¼ì„œ',
                'ì‹ ê·œ ì‚°ì¶œë¬¼ 3: ìŠ¹ì¸ ì™„ë£Œ ì•Œë¦¼'
            ];
            
            testItems.forEach(item => {
                outputsManager.addItem(item);
            });
            
            alert('í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // ì°¸ê³ ìë£Œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
        function testReferencesOperations() {
            const testItems = [
                'ì‹ ê·œ ì°¸ê³ ìë£Œ 1: ê´€ë ¨ ë²•ë ¹ í•´ì„ì„œ',
                'ì‹ ê·œ ì°¸ê³ ìë£Œ 2: ì—…ë¬´ ì²˜ë¦¬ ê°€ì´ë“œë¼ì¸',
                'ì‹ ê·œ ì°¸ê³ ìë£Œ 3: ì‚¬ë¡€ì§‘ ë° FAQ'
            ];
            
            testItems.forEach(item => {
                referencesManager.addItem(item);
            });
            
            alert('í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }
        
        // ëª¨ë“  ì‚°ì¶œë¬¼ ì œê±°
        function clearOutputs() {
            if (confirm('ëª¨ë“  ì‚°ì¶œë¬¼ì„ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                outputsManager.clear();
            }
        }
        
        // ëª¨ë“  ì°¸ê³ ìë£Œ ì œê±°
        function clearReferences() {
            if (confirm('ëª¨ë“  ì°¸ê³ ìë£Œë¥¼ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                referencesManager.clear();
            }
        }
        
        // í‘œì‹œ ì˜ˆì‹œ ì—…ë°ì´íŠ¸
        function updateDisplayDemo() {
            // ì‚°ì¶œë¬¼ í‘œì‹œ ì˜ˆì‹œ
            const outputsItems = outputsManager ? outputsManager.getItems() : [];
            const outputsHtml = outputsItems.length > 0 ? renderItemList(outputsItems, 'ğŸ“', true) : '<div class="no-data">ë“±ë¡ëœ ì‚°ì¶œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            document.getElementById('outputs-display-demo').innerHTML = `<div class="detail-item-list">${outputsHtml}</div>`;
            
            // ì°¸ê³ ìë£Œ í‘œì‹œ ì˜ˆì‹œ
            const referencesItems = referencesManager ? referencesManager.getItems() : [];
            const referencesHtml = referencesItems.length > 0 ? renderItemList(referencesItems, 'ğŸ“š', true) : '<div class="no-data">ë“±ë¡ëœ ì°¸ê³ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            document.getElementById('references-display-demo').innerHTML = `<div class="detail-item-list">${referencesHtml}</div>`;
        }
        
        // ê°œë³„ í•­ëª© ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ (ìƒˆë¡œìš´ ì²¨ë¶€íŒŒì¼ ì§€ì›)
        function renderItemList(items, icon = 'â€¢', withAttachment = false) {
            const processedItems = Utils.processItemsWithAttachments(items);
            
            if (processedItems.length === 0) {
                return '<div class="no-data">ë“±ë¡ëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
            
            return processedItems.map((item, index) => {
                const itemText = typeof item === 'string' ? item : (item.text || '');
                const hasAttachment = typeof item === 'object' && item.attachment;
                const attachment = hasAttachment ? item.attachment : null;
                
                return `
                    <div class="item-entry">
                        <div class="item-number">${index + 1}</div>
                        <div class="item-text">
                            ${icon} ${Utils.escapeHtml(itemText)}
                        </div>
                        ${withAttachment && hasAttachment ? `
                            <div class="item-attachment">
                                <a href="#" data-attachment-name="${Utils.escapeHtml(attachment.name)}" 
                               data-attachment-data="${attachment.data}" 
                               class="attachment-download-link" 
                                   title="ë‹¤ìš´ë¡œë“œ: ${Utils.escapeHtml(attachment.name)} (${Utils.formatFileSize(attachment.size)})">
                                    ğŸ“ ${Utils.escapeHtml(attachment.name)}
                                </a>
                                <span class="file-size">(${Utils.formatFileSize(attachment.size)})</span>
                            </div>
                        ` : (withAttachment ? `
                            <div class="item-attachment-placeholder">
                                <span class="no-attachment">ì²¨ë¶€íŒŒì¼ ì—†ìŒ</span>
                            </div>
                        ` : '')}
                    </div>
                `;
            }).join('');
        }
        
        // í…ŒìŠ¤íŠ¸ìš© ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ì´ë²¤íŠ¸ ë¸ë¦¬ê²Œì´ì…˜ ì‚¬ìš©)
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('attachment-download-link')) {
                e.preventDefault();
                
                const filename = e.target.getAttribute('data-attachment-name');
                const base64Data = e.target.getAttribute('data-attachment-data');
                
                if (filename && base64Data) {
                    console.log(`í…ŒìŠ¤íŠ¸ ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ: ${filename}`);
                    
                    const success = Utils.downloadBase64File(base64Data, filename);
                    if (success) {
                        alert(`íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ: ${filename}`);
                    } else {
                        alert(`íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: ${filename}`);
                    }
                } else {
                    alert('ì²¨ë¶€íŒŒì¼ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }
        });
        
        // í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸
        function testCompatibility() {
            const testCases = [
                {
                    name: 'ê¸°ì¡´ ë¬¸ìì—´ ë°ì´í„°',
                    input: 'í•­ëª©1\ní•­ëª©2\ní•­ëª©3',
                    expected: ['í•­ëª©1', 'í•­ëª©2', 'í•­ëª©3']
                },
                {
                    name: 'ê¸°ì¡´ ë°°ì—´ ë°ì´í„°',
                    input: ['ë°°ì—´í•­ëª©1', 'ë°°ì—´í•­ëª©2', 'ë°°ì—´í•­ëª©3'],
                    expected: ['ë°°ì—´í•­ëª©1', 'ë°°ì—´í•­ëª©2', 'ë°°ì—´í•­ëª©3']
                },
                {
                    name: 'ë¹ˆ ë°ì´í„°',
                    input: '',
                    expected: []
                },
                {
                    name: 'ê³µë°±ì´ í¬í•¨ëœ ë°ì´í„°',
                    input: '  í•­ëª©1  \n\n  í•­ëª©2  \n   \ní•­ëª©3   ',
                    expected: ['í•­ëª©1', 'í•­ëª©2', 'í•­ëª©3']
                }
            ];
            
            let results = '';
            let allPassed = true;
            
            testCases.forEach(testCase => {
                const result = Utils.processMultilineData(testCase.input);
                const passed = JSON.stringify(result) === JSON.stringify(testCase.expected);
                
                if (!passed) allPassed = false;
                
                results += `
                    <div style="margin: 10px 0; padding: 10px; background: ${passed ? '#d4edda' : '#f8d7da'}; border-radius: 4px;">
                        <strong>${testCase.name}:</strong> ${passed ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}<br>
                        ì…ë ¥: ${JSON.stringify(testCase.input)}<br>
                        ì˜ˆìƒ: ${JSON.stringify(testCase.expected)}<br>
                        ì‹¤ì œ: ${JSON.stringify(result)}
                    </div>
                `;
            });
            
            // ì–‘ë°©í–¥ ë³€í™˜ í…ŒìŠ¤íŠ¸
            const items = ['í…ŒìŠ¤íŠ¸1', 'í…ŒìŠ¤íŠ¸2', 'í…ŒìŠ¤íŠ¸3'];
            const toText = Utils.itemsToText(items);
            const backToItems = Utils.textToItems(toText);
            const roundTripPassed = JSON.stringify(items) === JSON.stringify(backToItems);
            
            if (!roundTripPassed) allPassed = false;
            
            results += `
                <div style="margin: 10px 0; padding: 10px; background: ${roundTripPassed ? '#d4edda' : '#f8d7da'}; border-radius: 4px;">
                    <strong>ì–‘ë°©í–¥ ë³€í™˜ í…ŒìŠ¤íŠ¸:</strong> ${roundTripPassed ? 'âœ… í†µê³¼' : 'âŒ ì‹¤íŒ¨'}<br>
                    ì›ë³¸: ${JSON.stringify(items)}<br>
                    í…ìŠ¤íŠ¸ ë³€í™˜: "${toText}"<br>
                    ë‹¤ì‹œ ë°°ì—´ë¡œ: ${JSON.stringify(backToItems)}
                </div>
            `;
            
            results = `<h4 style="color: ${allPassed ? 'green' : 'red'};">ì „ì²´ í…ŒìŠ¤íŠ¸ ê²°ê³¼: ${allPassed ? 'âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼' : 'âŒ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨'}</h4>` + results;
            
            document.getElementById('compatibility-results').innerHTML = results;
        }
    </script>
</body>
</html>