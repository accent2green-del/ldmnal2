<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>새 형식 JSON 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2rem; }
        .result { margin: 1rem 0; padding: 1rem; border: 1px solid #ccc; }
        .success { border-color: green; background: #f0fff0; }
        .error { border-color: red; background: #fff0f0; }
        button { padding: 0.5rem 1rem; margin: 0.5rem; }
        pre { background: #f5f5f5; padding: 1rem; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>새 형식 JSON 데이터 변환 테스트</h1>
    
    <button onclick="testConversion()">새 형식 JSON 변환 테스트</button>
    <button onclick="loadNewData()">새 데이터 실제 적용</button>
    <button onclick="showCurrentData()">현재 데이터 확인</button>
    
    <div id="result"></div>
    
    <script src="js/config.js"></script>
    <script src="js/data-manager.js"></script>
    
    <script>
        // 테스트용 간단 데이터 매니저 생성
        const testDataManager = new DataManager();
        
        async function testConversion() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>새 형식 JSON 데이터 로드 중...</p>';
            
            try {
                // 새 형식 JSON 파일 로드
                const response = await fetch('new-format-data.json');
                const newFormatData = await response.json();
                
                console.log('원본 데이터:', newFormatData);
                
                // 변환 테스트
                const convertedData = testDataManager.convertNewFormatToStandard(newFormatData);
                
                console.log('변환된 데이터:', convertedData);
                
                resultDiv.innerHTML = `
                    <div class="result success">
                        <h3>✅ 변환 성공!</h3>
                        <p><strong>원본 데이터:</strong> ${newFormatData.length}개 업무</p>
                        <p><strong>변환 결과:</strong></p>
                        <ul>
                            <li>부서: ${convertedData.departments.length}개</li>
                            <li>카테고리: ${convertedData.categories.length}개</li>
                            <li>프로세스: ${convertedData.processes.length}개</li>
                        </ul>
                        <h4>변환된 데이터 구조 (일부):</h4>
                        <pre>${JSON.stringify({
                            departments: convertedData.departments.slice(0, 2),
                            categories: convertedData.categories.slice(0, 3),
                            processes: convertedData.processes.slice(0, 2)
                        }, null, 2)}</pre>
                    </div>
                `;
                
            } catch (error) {
                console.error('변환 테스트 실패:', error);
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>❌ 변환 실패</h3>
                        <p>오류: ${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }
        
        async function loadNewData() {
            const resultDiv = document.getElementById('result');
            
            try {
                const response = await fetch('new-format-data.json');
                const newFormatData = await response.json();
                
                const success = testDataManager.importNewFormatData(newFormatData);
                
                if (success) {
                    const summary = testDataManager.getDataSummary();
                    resultDiv.innerHTML = `
                        <div class="result success">
                            <h3>✅ 데이터 적용 성공!</h3>
                            <p>새 형식 데이터가 성공적으로 시스템에 적용되었습니다.</p>
                            <p><strong>현재 데이터:</strong></p>
                            <ul>
                                <li>부서: ${summary.departments}개</li>
                                <li>카테고리: ${summary.categories}개</li>
                                <li>프로세스: ${summary.processes}개</li>
                            </ul>
                        </div>
                    `;
                } else {
                    throw new Error('데이터 적용 실패');
                }
                
            } catch (error) {
                console.error('데이터 적용 실패:', error);
                resultDiv.innerHTML = `
                    <div class="result error">
                        <h3>❌ 데이터 적용 실패</h3>
                        <p>오류: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        function showCurrentData() {
            const currentData = testDataManager.getAllData();
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = `
                <div class="result">
                    <h3>현재 시스템 데이터</h3>
                    <p><strong>부서 목록:</strong></p>
                    <ul>
                        ${currentData.departments.map(dept => `<li>${dept.name}</li>`).join('')}
                    </ul>
                    <p><strong>카테고리 목록 (일부):</strong></p>
                    <ul>
                        ${currentData.categories.slice(0, 10).map(cat => `<li>${cat.name} (${currentData.departments.find(d => d.id === cat.departmentId)?.name})</li>`).join('')}
                    </ul>
                    <p><strong>프로세스 목록 (일부):</strong></p>
                    <ul>
                        ${currentData.processes.slice(0, 10).map(proc => `<li>${proc.title}</li>`).join('')}
                    </ul>
                    ${currentData.processes.length > 10 ? `<p>... 그 외 ${currentData.processes.length - 10}개</p>` : ''}
                </div>
            `;
        }
    </script>
</body>
</html>