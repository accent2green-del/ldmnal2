<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë¡œì„¸ìŠ¤ ìˆ˜ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        .btn:hover {
            background: #138496;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #218838;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border: 1px solid #e9ecef;
            font-family: monospace;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .process-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        .process-title {
            font-weight: bold;
            color: #17a2b8;
            margin-bottom: 10px;
        }
        .process-detail {
            margin: 5px 0;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>ğŸ› ï¸ í”„ë¡œì„¸ìŠ¤ ìˆ˜ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ í™•ì¸</h2>
        <button class="btn" onclick="checkAppStatus()">ğŸ” ìƒíƒœ í™•ì¸</button>
        <button class="btn btn-success" onclick="openMainApp()">ğŸš€ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì—´ê¸°</button>
        <div id="app-status" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ í”„ë¡œì„¸ìŠ¤ ìˆ˜ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸</h2>
        
        <h3>1ï¸âƒ£ ìƒ˜í”Œ í”„ë¡œì„¸ìŠ¤ ìƒì„±</h3>
        <button class="btn" onclick="createSampleProcess()">ğŸ“ ìƒ˜í”Œ í”„ë¡œì„¸ìŠ¤ ìƒì„±</button>
        <div id="sample-process" class="result"></div>
        
        <h3>2ï¸âƒ£ ìˆ˜ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸</h3>
        <button class="btn" onclick="testEditModal()" id="test-edit-btn" disabled>âœï¸ ìˆ˜ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸</button>
        <div id="edit-result" class="result"></div>
        
        <h3>3ï¸âƒ£ í”„ë¡œì„¸ìŠ¤ ëª©ë¡ í™•ì¸</h3>
        <button class="btn" onclick="showProcessList()">ğŸ“‹ í”„ë¡œì„¸ìŠ¤ ëª©ë¡ ë³´ê¸°</button>
        <div id="process-list" class="result"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ í…ŒìŠ¤íŠ¸ ì§„í–‰ ìˆœì„œ</h2>
        <div class="result">
            <ol>
                <li><strong>ìƒíƒœ í™•ì¸</strong>: ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì œëŒ€ë¡œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸</li>
                <li><strong>ìƒ˜í”Œ í”„ë¡œì„¸ìŠ¤ ìƒì„±</strong>: í…ŒìŠ¤íŠ¸ìš© í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±</li>
                <li><strong>ìˆ˜ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸</strong>: ìƒì„±ëœ í”„ë¡œì„¸ìŠ¤ì˜ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°</li>
                <li><strong>ìƒˆ í•„ë“œ í™•ì¸</strong>: ì£¼ìš” ì—…ë¬´ ë‚´ìš©, ì‚°ì¶œë¬¼, ì°¸ê³  ìë£Œ í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸</li>
                <li><strong>ë°ì´í„° ì…ë ¥</strong>: ê° í•„ë“œì— ë°ì´í„° ì…ë ¥ í›„ ì €ì¥</li>
                <li><strong>ê²°ê³¼ í™•ì¸</strong>: ì €ì¥ëœ ë°ì´í„°ê°€ ì œëŒ€ë¡œ ë°˜ì˜ë˜ì—ˆëŠ”ì§€ í™•ì¸</li>
            </ol>
        </div>
    </div>

    <script>
        let testProcessId = null;
        
        function openMainApp() {
            const currentUrl = window.location.origin;
            window.open(currentUrl, '_blank');
        }
        
        function checkAppStatus() {
            const statusDiv = document.getElementById('app-status');
            
            try {
                // ë¶€ëª¨ ì°½ì—ì„œ dataManagerì™€ adminManager í™•ì¸
                if (window.opener && window.opener.dataManager && window.opener.adminManager) {
                    const dm = window.opener.dataManager;
                    const am = window.opener.adminManager;
                    
                    const departments = dm.getDepartments();
                    const categories = dm.getCategories();
                    const processes = dm.data.processes;
                    
                    let statusHtml = '<div class="success">âœ… ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ ì •ìƒ</div>';
                    statusHtml += `<strong>ë°ì´í„° ìƒíƒœ:</strong><br>`;
                    statusHtml += `- ë¶€ì„œ: ${departments.length}ê°œ<br>`;
                    statusHtml += `- ì¹´í…Œê³ ë¦¬: ${categories.length}ê°œ<br>`;
                    statusHtml += `- í”„ë¡œì„¸ìŠ¤: ${processes.length}ê°œ<br>`;
                    statusHtml += `<strong>AdminManager:</strong> ${am.isLoggedIn ? 'ë¡œê·¸ì¸ë¨' : 'ë¡œê·¸ì¸ í•„ìš”'}<br>`;
                    
                    statusDiv.innerHTML = statusHtml;
                    
                } else {
                    statusDiv.innerHTML = '<div class="error">âŒ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¨¼ì € ì—´ì–´ì£¼ì„¸ìš”.</div>';
                }
                
            } catch (error) {
                statusDiv.innerHTML = '<div class="error">âŒ ì˜¤ë¥˜: ' + error.message + '</div>';
            }
        }
        
        function createSampleProcess() {
            const sampleDiv = document.getElementById('sample-process');
            
            try {
                if (!window.opener || !window.opener.dataManager) {
                    sampleDiv.innerHTML = '<div class="error">âŒ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                const dm = window.opener.dataManager;
                const departments = dm.getDepartments();
                const categories = dm.getCategories();
                
                if (departments.length === 0 || categories.length === 0) {
                    sampleDiv.innerHTML = '<div class="error">âŒ ë¶€ì„œ ë˜ëŠ” ì¹´í…Œê³ ë¦¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                // ì²« ë²ˆì§¸ ì¹´í…Œê³ ë¦¬ ì„ íƒ
                const firstCategory = categories[0];
                
                // ìƒ˜í”Œ í”„ë¡œì„¸ìŠ¤ ìƒì„±
                const sampleProcess = {
                    id: 'test-proc-' + Date.now(),
                    title: 'í…ŒìŠ¤íŠ¸ í”„ë¡œì„¸ìŠ¤ (ìˆ˜ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸ìš©)',
                    categoryId: firstCategory.id,
                    stepDescription: 'ì´ê²ƒì€ ìˆ˜ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìƒ˜í”Œ í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤.',
                    mainContent: ['ê¸°ì¡´ ì—…ë¬´ ë‚´ìš© 1', 'ê¸°ì¡´ ì—…ë¬´ ë‚´ìš© 2', 'ê¸°ì¡´ ì—…ë¬´ ë‚´ìš© 3'],
                    outputs: ['ê¸°ì¡´ ì‚°ì¶œë¬¼ 1', 'ê¸°ì¡´ ì‚°ì¶œë¬¼ 2'],
                    references: ['ê¸°ì¡´ ì°¸ê³  ìë£Œ 1', 'ê¸°ì¡´ ì°¸ê³  ìë£Œ 2', 'ê¸°ì¡´ ì°¸ê³  ìë£Œ 3'],
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // ë°ì´í„°ì— ì¶”ê°€
                dm.data.processes.push(sampleProcess);
                dm.saveToStorage();
                
                testProcessId = sampleProcess.id;
                
                let html = '<div class="success">âœ… ìƒ˜í”Œ í”„ë¡œì„¸ìŠ¤ ìƒì„± ì™„ë£Œ</div>';
                html += `<strong>í”„ë¡œì„¸ìŠ¤ ID:</strong> ${sampleProcess.id}<br>`;
                html += `<strong>í”„ë¡œì„¸ìŠ¤ëª…:</strong> ${sampleProcess.title}<br>`;
                html += `<strong>ì¹´í…Œê³ ë¦¬:</strong> ${firstCategory.name}<br>`;
                html += `<strong>ì£¼ìš” ì—…ë¬´ ë‚´ìš©:</strong> ${sampleProcess.mainContent.length}ê°œ í•­ëª©<br>`;
                html += `<strong>ì‚°ì¶œë¬¼:</strong> ${sampleProcess.outputs.length}ê°œ í•­ëª©<br>`;
                html += `<strong>ì°¸ê³  ìë£Œ:</strong> ${sampleProcess.references.length}ê°œ í•­ëª©<br>`;
                
                sampleDiv.innerHTML = html;
                
                // ìˆ˜ì • ëª¨ë‹¬ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ í™œì„±í™”
                document.getElementById('test-edit-btn').disabled = false;
                
            } catch (error) {
                sampleDiv.innerHTML = '<div class="error">âŒ ì˜¤ë¥˜: ' + error.message + '</div>';
            }
        }
        
        function testEditModal() {
            const resultDiv = document.getElementById('edit-result');
            
            try {
                if (!testProcessId || !window.opener || !window.opener.adminManager) {
                    resultDiv.innerHTML = '<div class="error">âŒ í…ŒìŠ¤íŠ¸ í”„ë¡œì„¸ìŠ¤ê°€ ì—†ê±°ë‚˜ AdminManagerì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                const am = window.opener.adminManager;
                const dm = window.opener.dataManager;
                
                // í”„ë¡œì„¸ìŠ¤ ì°¾ê¸°
                const process = dm.data.processes.find(p => p.id === testProcessId);
                if (!process) {
                    resultDiv.innerHTML = '<div class="error">âŒ í…ŒìŠ¤íŠ¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                // ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
                am.showEditProcessModal(process);
                
                let html = '<div class="success">âœ… ìˆ˜ì • ëª¨ë‹¬ì´ ì—´ë ¸ìŠµë‹ˆë‹¤!</div>';
                html += '<strong>í™•ì¸ ì‚¬í•­:</strong><br>';
                html += '1. ëª¨ë‹¬ì— ë‹¤ìŒ í•„ë“œë“¤ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”:<br>';
                html += '&nbsp;&nbsp;- í”„ë¡œì„¸ìŠ¤ëª…<br>';
                html += '&nbsp;&nbsp;- í”„ë¡œì„¸ìŠ¤ ì„¤ëª…<br>';
                html += '&nbsp;&nbsp;- <strong>ì£¼ìš” ì—…ë¬´ ë‚´ìš©</strong> (ìƒˆë¡œ ì¶”ê°€ë¨)<br>';
                html += '&nbsp;&nbsp;- <strong>ì‚°ì¶œë¬¼</strong> (ìƒˆë¡œ ì¶”ê°€ë¨)<br>';
                html += '&nbsp;&nbsp;- <strong>ì°¸ê³  ìë£Œ</strong> (ìƒˆë¡œ ì¶”ê°€ë¨)<br><br>';
                html += '2. ê° í•„ë“œì— ê¸°ì¡´ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸<br>';
                html += '3. ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì…ë ¥í•˜ê³  ì €ì¥í•´ë³´ì„¸ìš”<br>';
                html += '4. ì €ì¥ í›„ ë‹¤ì‹œ ìˆ˜ì • ëª¨ë‹¬ì„ ì—´ì–´ì„œ ë³€ê²½ì‚¬í•­ì´ ë°˜ì˜ë˜ì—ˆëŠ”ì§€ í™•ì¸<br>';
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = '<div class="error">âŒ ì˜¤ë¥˜: ' + error.message + '</div>';
            }
        }
        
        function showProcessList() {
            const listDiv = document.getElementById('process-list');
            
            try {
                if (!window.opener || !window.opener.dataManager) {
                    listDiv.innerHTML = '<div class="error">âŒ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }
                
                const dm = window.opener.dataManager;
                const processes = dm.data.processes;
                const categories = dm.getCategories();
                
                let html = `<strong>ğŸ“‹ ì „ì²´ í”„ë¡œì„¸ìŠ¤ ëª©ë¡ (${processes.length}ê°œ)</strong><br><br>`;
                
                processes.forEach((proc, idx) => {
                    const category = categories.find(c => c.id === proc.categoryId);
                    const isTestProcess = proc.id === testProcessId;
                    
                    html += `<div class="process-item${isTestProcess ? ' success' : ''}">`;
                    html += `<div class="process-title">${idx + 1}. ${proc.title}${isTestProcess ? ' ğŸ§ª' : ''}</div>`;
                    html += `<div class="process-detail">ì¹´í…Œê³ ë¦¬: ${category ? category.name : 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>`;
                    html += `<div class="process-detail">ì„¤ëª…: ${proc.stepDescription || proc.description || 'ì—†ìŒ'}</div>`;
                    if (proc.mainContent && proc.mainContent.length > 0) {
                        html += `<div class="process-detail">ì£¼ìš” ì—…ë¬´ ë‚´ìš©: ${proc.mainContent.length}ê°œ í•­ëª©</div>`;
                    }
                    if (proc.outputs && proc.outputs.length > 0) {
                        html += `<div class="process-detail">ì‚°ì¶œë¬¼: ${proc.outputs.length}ê°œ í•­ëª©</div>`;
                    }
                    if (proc.references && proc.references.length > 0) {
                        html += `<div class="process-detail">ì°¸ê³  ìë£Œ: ${proc.references.length}ê°œ í•­ëª©</div>`;
                    }
                    html += `</div>`;
                });
                
                listDiv.innerHTML = html;
                
            } catch (error) {
                listDiv.innerHTML = '<div class="error">âŒ ì˜¤ë¥˜: ' + error.message + '</div>';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            setTimeout(checkAppStatus, 1000);
        });
    </script>
</body>
</html>