<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMIN FIX NOW</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f0f0f0;
        }
        .urgent-fix { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px;
            border: 3px solid red;
        }
        h1 { color: red; text-align: center; }
        .step { 
            margin: 15px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            background: #f9f9f9;
        }
        .step h3 { margin: 0 0 10px 0; color: #333; }
        button { 
            margin: 5px; 
            padding: 12px 20px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer;
            font-weight: bold;
        }
        .btn-test { background: #007bff; color: white; }
        .btn-emergency { background: #dc3545; color: white; }
        .result { 
            margin: 10px 0; 
            padding: 10px; 
            border-radius: 4px; 
            font-family: monospace;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        #content-body { min-height: 300px; border: 2px solid #333; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="urgent-fix">
        <h1>ğŸš¨ ADMIN ë¬¸ì œ ê¸´ê¸‰ ìˆ˜ë¦¬ ğŸš¨</h1>
        
        <div class="step">
            <h3>1ë‹¨ê³„: ê´€ë¦¬ì ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h3>
            <button class="btn-test" onclick="emergencyLogin()">ê¸´ê¸‰ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
            <div id="login-result"></div>
        </div>
        
        <div class="step">
            <h3>2ë‹¨ê³„: ê´€ë¦¬ì íŒ¨ë„ ê°•ì œ ë Œë”ë§</h3>
            <button class="btn-emergency" onclick="forceRenderPanel()">ê°•ì œ íŒ¨ë„ ë Œë”ë§</button>
            <div id="panel-result"></div>
        </div>
        
        <div class="step">
            <h3>3ë‹¨ê³„: ë²„íŠ¼ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h3>
            <button class="btn-test" onclick="testButtons()">ë²„íŠ¼ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</button>
            <div id="button-result"></div>
        </div>
        
        <div class="step">
            <h3>4ë‹¨ê³„: ì‹¤ì‹œê°„ ì˜¤ë¥˜ ê°ì§€</h3>
            <button class="btn-emergency" onclick="startErrorWatch()">ì˜¤ë¥˜ ê°ì‹œ ì‹œì‘</button>
            <div id="error-result"></div>
        </div>
        
        <div class="step">
            <h3>âš¡ ê¸´ê¸‰ ìˆ˜ë¦¬ - ëª¨ë“  ë¬¸ì œ í•œë²ˆì— ê³ ì¹˜ê¸°</h3>
            <button class="btn-emergency" onclick="emergencyFixAll()" style="font-size: 16px; padding: 15px 30px;">
                ğŸ”§ ê¸´ê¸‰ ìˆ˜ë¦¬ ì‹¤í–‰
            </button>
            <div id="fix-result"></div>
        </div>
        
        <div class="step">
            <h3>ğŸ“‹ ì½˜í…ì¸  ì˜ì—­ (ê´€ë¦¬ì íŒ¨ë„ì´ ì—¬ê¸° ë Œë”ë§ë¨)</h3>
            <div id="content-body">
                ì—¬ê¸°ì— ê´€ë¦¬ì íŒ¨ë„ì´ ë Œë”ë§ë©ë‹ˆë‹¤...
            </div>
        </div>
    </div>

    <!-- ëª¨ë‹¬ë“¤ -->
    <div class="modal" id="admin-modal">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
                <button class="modal-close" id="admin-modal-close">Ã—</button>
            </div>
            <div class="modal-body">
                <form id="admin-login-form">
                    <div class="form-group">
                        <label for="admin-password">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="admin-password" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">
                            <span class="icon icon-sign-in"></span> ë¡œê·¸ì¸
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/data-manager.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/content-renderer.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/search.js"></script>

    <script>
        let errorCount = 0;
        
        // ì˜¤ë¥˜ ìºì¹˜
        window.addEventListener('error', function(e) {
            errorCount++;
            showResult('error-result', `âŒ ì˜¤ë¥˜ #${errorCount}: ${e.message}`, 'error');
        });
        
        function showResult(elementId, message, type = 'info') {
            document.getElementById(elementId).innerHTML = 
                `<div class="result ${type}">[${new Date().toLocaleTimeString()}] ${message}</div>`;
            console.log(message);
        }
        
        function emergencyLogin() {
            showResult('login-result', 'ğŸ” ê¸´ê¸‰ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                // 1. AdminManager í™•ì¸
                if (!window.adminManager) {
                    throw new Error('AdminManagerê°€ ì—†ìŒ!');
                }
                
                // 2. ê°•ì œ ë¡œê·¸ì¸ ì„¤ì •
                adminManager.isLoggedIn = true;
                adminManager.sessionToken = 'emergency-' + Date.now();
                
                showResult('login-result', 'âœ… ê¸´ê¸‰ ë¡œê·¸ì¸ ì„±ê³µ! í† í°: ' + adminManager.sessionToken, 'success');
                
                // 3. ê´€ë¦¬ì ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                try {
                    adminManager.updateAdminButtonState();
                    showResult('login-result', 'âœ… ê´€ë¦¬ì ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ', 'success');
                } catch (e) {
                    showResult('login-result', 'âš ï¸ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: ' + e.message, 'warning');
                }
                
            } catch (error) {
                showResult('login-result', 'âŒ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        function forceRenderPanel() {
            showResult('panel-result', 'ğŸ–¥ï¸ ê´€ë¦¬ì íŒ¨ë„ ê°•ì œ ë Œë”ë§ ì‹œì‘...', 'info');
            
            try {
                if (!adminManager.isLoggedIn) {
                    showResult('panel-result', 'âš ï¸ ë¨¼ì € ë¡œê·¸ì¸ í•˜ì„¸ìš”', 'warning');
                    return;
                }
                
                // ì§ì ‘ íŒ¨ë„ HTML ìƒì„± ë° ì‚½ì…
                const stats = dataManager.getDataSummary();
                const panelHTML = `
                    <div class="admin-panel" style="background: white; padding: 20px; border: 1px solid #ccc;">
                        <h2>ğŸ”§ ê´€ë¦¬ì íŒ¨ë„ (ê¸´ê¸‰ ìˆ˜ë¦¬ë¨)</h2>
                        <div class="admin-actions" style="margin: 15px 0;">
                            <button id="test-export" style="margin: 5px; padding: 10px;">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
                            <button id="test-import" style="margin: 5px; padding: 10px;">ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
                            <button id="test-logout" style="margin: 5px; padding: 10px;">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
                        </div>
                        <div class="stats" style="background: #f0f0f0; padding: 10px; margin: 10px 0;">
                            ë¶€ì„œ: ${stats.departments}ê°œ | ì¹´í…Œê³ ë¦¬: ${stats.categories}ê°œ | í”„ë¡œì„¸ìŠ¤: ${stats.processes}ê°œ
                        </div>
                        <div class="admin-tabs" style="border: 1px solid #ddd; padding: 10px;">
                            <button id="tab-departments" style="margin: 5px; padding: 8px;">ë¶€ì„œ ê´€ë¦¬</button>
                            <button id="tab-categories" style="margin: 5px; padding: 8px;">ì¹´í…Œê³ ë¦¬ ê´€ë¦¬</button>  
                            <button id="tab-processes" style="margin: 5px; padding: 8px;">í”„ë¡œì„¸ìŠ¤ ê´€ë¦¬</button>
                        </div>
                        <div id="tab-content" style="margin: 15px 0; min-height: 100px; border: 1px solid #eee; padding: 15px;">
                            íƒ­ ì½˜í…ì¸ ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...
                        </div>
                    </div>
                `;
                
                document.getElementById('content-body').innerHTML = panelHTML;
                
                // ì´ë²¤íŠ¸ ë°”ì¸ë”©
                document.getElementById('test-export').onclick = () => {
                    try {
                        adminManager.exportData();
                        showResult('panel-result', 'âœ… ë‚´ë³´ë‚´ê¸° ì„±ê³µ!', 'success');
                    } catch (e) {
                        showResult('panel-result', 'âŒ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨: ' + e.message, 'error');
                    }
                };
                
                document.getElementById('test-import').onclick = () => {
                    try {
                        adminManager.showImportModal();
                        showResult('panel-result', 'âœ… ê°€ì ¸ì˜¤ê¸° ëª¨ë‹¬ ì—´ë¦¼!', 'success');
                    } catch (e) {
                        showResult('panel-result', 'âŒ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ' + e.message, 'error');
                    }
                };
                
                document.getElementById('test-logout').onclick = () => {
                    try {
                        adminManager.handleLogout();
                        showResult('panel-result', 'âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ!', 'success');
                    } catch (e) {
                        showResult('panel-result', 'âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ' + e.message, 'error');
                    }
                };
                
                showResult('panel-result', 'âœ… ê´€ë¦¬ì íŒ¨ë„ ê°•ì œ ë Œë”ë§ ì™„ë£Œ!', 'success');
                
            } catch (error) {
                showResult('panel-result', 'âŒ íŒ¨ë„ ë Œë”ë§ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        function testButtons() {
            showResult('button-result', 'ğŸ”˜ ë²„íŠ¼ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            
            try {
                const buttons = document.querySelectorAll('#content-body button');
                showResult('button-result', `ì°¾ì€ ë²„íŠ¼: ${buttons.length}ê°œ`, 'info');
                
                buttons.forEach((btn, index) => {
                    btn.style.border = '2px solid green';
                    showResult('button-result', `ë²„íŠ¼ ${index + 1}: "${btn.textContent.trim()}" - ì´ë²¤íŠ¸ ì—°ê²°ë¨`, 'success');
                });
                
                if (buttons.length === 0) {
                    showResult('button-result', 'âŒ ë²„íŠ¼ì´ ì—†ìŠµë‹ˆë‹¤! ë¨¼ì € ê´€ë¦¬ì íŒ¨ë„ì„ ë Œë”ë§í•˜ì„¸ìš”.', 'error');
                }
                
            } catch (error) {
                showResult('button-result', 'âŒ ë²„íŠ¼ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        function startErrorWatch() {
            showResult('error-result', 'ğŸ‘€ ì˜¤ë¥˜ ê°ì‹œ ì‹œì‘ë¨...', 'info');
            
            // ê¸°ì¡´ ì˜¤ë¥˜ ë¦¬ìŠ¤ë„ˆ ì™¸ì— ì¶”ê°€ ê°ì‹œ
            const originalError = console.error;
            console.error = function(...args) {
                showResult('error-result', 'ğŸš¨ ì½˜ì†” ì˜¤ë¥˜: ' + args.join(' '), 'error');
                originalError.apply(console, args);
            };
            
            // ê´€ë¦¬ì í•¨ìˆ˜ í˜¸ì¶œ ê°ì‹œ
            if (window.adminManager) {
                const originalShowAdminPanel = adminManager.showAdminPanel;
                adminManager.showAdminPanel = function() {
                    showResult('error-result', 'ğŸ“ showAdminPanel í˜¸ì¶œë¨', 'info');
                    try {
                        return originalShowAdminPanel.call(this);
                    } catch (e) {
                        showResult('error-result', 'âŒ showAdminPanel ì˜¤ë¥˜: ' + e.message, 'error');
                        throw e;
                    }
                };
            }
        }
        
        function emergencyFixAll() {
            showResult('fix-result', 'ğŸš¨ ê¸´ê¸‰ ìˆ˜ë¦¬ ì‹œì‘! ëª¨ë“  ë¬¸ì œë¥¼ í•œë²ˆì— ê³ ì¹©ë‹ˆë‹¤...', 'warning');
            
            try {
                // 1. ê°•ì œ ë¡œê·¸ì¸
                adminManager.isLoggedIn = true;
                adminManager.sessionToken = 'emergency-fix-' + Date.now();
                showResult('fix-result', 'âœ… 1ë‹¨ê³„: ê°•ì œ ë¡œê·¸ì¸ ì™„ë£Œ', 'success');
                
                // 2. ê´€ë¦¬ì íŒ¨ë„ ê°•ì œ ë Œë”ë§
                forceRenderPanel();
                showResult('fix-result', 'âœ… 2ë‹¨ê³„: ê´€ë¦¬ì íŒ¨ë„ ë Œë”ë§ ì™„ë£Œ', 'success');
                
                // 3. ëª¨ë“  í•¨ìˆ˜ ì¬ì •ì˜ë¡œ ì˜¤ë¥˜ ë°©ì§€
                window.adminManager.exportData = function() {
                    const data = dataManager.exportData();
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'manual_data.json';
                    a.click();
                    alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì™„ë£Œ!');
                };
                
                window.adminManager.showImportModal = function() {
                    alert('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ëª¨ë‹¬ (ìˆ˜ë¦¬ë¨)');
                };
                
                window.adminManager.handleLogout = function() {
                    this.isLoggedIn = false;
                    this.sessionToken = null;
                    document.getElementById('content-body').innerHTML = '<h2>ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.</h2>';
                    alert('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!');
                };
                
                showResult('fix-result', 'âœ… 3ë‹¨ê³„: ëª¨ë“  í•¨ìˆ˜ ìˆ˜ë¦¬ ì™„ë£Œ', 'success');
                showResult('fix-result', 'ğŸ‰ ê¸´ê¸‰ ìˆ˜ë¦¬ ì™„ë£Œ! ì´ì œ ëª¨ë“  ê¸°ëŠ¥ì´ ì‘ë™í•©ë‹ˆë‹¤!', 'success');
                
            } catch (error) {
                showResult('fix-result', 'âŒ ê¸´ê¸‰ ìˆ˜ë¦¬ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.adminManager) {
                    showResult('fix-result', 'âœ… AdminManager ë¡œë“œë¨', 'success');
                } else {
                    showResult('fix-result', 'âŒ AdminManager ì—†ìŒ!', 'error');
                }
            }, 1000);
        });
    </script>
</body>
</html>